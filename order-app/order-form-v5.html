<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>×˜×•×¤×¡ ×”×–×× ×” - ×§×™×™×˜×¨×™× ×’ ××’×“×”</title>

    <style>
      /* --- Google Font --- */
      @import url("https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap");

      :root {
        --color-primary: #56ab2f;
        --color-primary-light: #a8e063;
        --color-primary-faint: #f0f9eb;
        --color-primary-dark: #428d23;

        --color-background: #f8f9fa;
        --color-surface: #ffffff;

        --color-text-strong: #333;
        --color-text-default: #666;
        --color-text-muted: #6c757d;
        --color-text-on-primary: #ffffff;

        --color-border: #e9ecef;
        --color-border-light: #e0e0e0;

        --color-danger: #e53e3e;
        --color-whatsapp: #25d366;
        --color-whatsapp-hover: #1dae54;

        --color-feedback-background: #fff3cd;
        --color-feedback-text: #856404;
        --color-feedback-border: #ffeeba;
        --color-indicator: #f97316;

        --color-overlay: rgba(0, 0, 0, 0.6);

        --shadow-sm: rgba(0, 0, 0, 0.05);
        --shadow-primary-sm: rgba(86, 171, 47, 0.2);
        --shadow-primary-md: rgba(86, 171, 47, 0.3);
        --shadow-primary-lg: rgba(86, 171, 47, 0.1);
        --shadow-whatsapp: rgba(37, 211, 102, 0.3);
        --shadow-indicator: rgba(249, 115, 22, 0.7);
        --shadow-indicator-end: rgba(249, 115, 22, 0);
      }

      /* --- NEW --- Dark Mode Theme */
      html.dark {
        --color-primary: #65c33a;
        --color-primary-light: #a8e063;
        --color-primary-faint: #2a3b25;

        --color-background: #070707;
        --color-surface: #101010;

        --color-text-strong: #f9fafb;
        --color-text-default: #d1d5db;
        --color-text-muted: #9ca3af;
        --color-text-on-primary: #ffffff;

        --color-border: #282828;
        --color-border-light: #4b5563;

        --color-feedback-background: #4a3a1a;
        --color-feedback-text: #fde68a;
        --color-feedback-border: #78350f;

        --shadow-sm: rgba(0, 0, 0, 0.2);
        --shadow-primary-lg: rgba(168, 224, 99, 0.1);
      }

      body {
        margin: 0;
        background: var(--color-background);
        color: var(--color-text-default);
        touch-action: manipulation;
      }

      .container * {
        font-family: "Assistant", sans-serif;
        box-sizing: border-box;
      }

      [type="button"]:focus,
      [type="button"]:hover,
      [type="submit"]:focus,
      [type="submit"]:hover,
      button:focus,
      button:hover {
        background-color: #4d7529 !important;
      }

      .container {
        display: grid;
        grid-template-columns: 1fr 400px;
        margin: 0 auto;
        min-height: 100vh;
        gap: 0;
        max-width: 1440px;
        background: var(--color-background);
      }

      .main-content {
        /* background: var(--color-surface); */
        padding: 40px;
        position: relative;
        padding-bottom: 40px;
      }

      .sidebar {
        background: var(--color-background);
        padding: 30px;
        border-right: 1px solid var(--color-border);
        position: sticky;
        top: 0;
        height: 100vh;
        overflow-y: auto;
      }

      .form-header-main {
        background: var(--color-surface);

        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px var(--shadow-sm);
        border: 2px solid var(--color-border);
      }

      .form-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--color-border);
      }

      .header-logo {
        display: flex !important;
        align-items: center;
        gap: 10px;
      }

      .header-logo .title {
        font-weight: 900;
        font-size: 1.2rem;
        font-family: "Assistant";
        line-height: 1em;
        color: var(--color-primary);
      }

      .header-logo img {
        height: 50px;
      }

      .header-contact {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--color-primary);
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .header-contact a {
        color: inherit;
        text-decoration: none;
      }

      .progress-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
      }

      .progress-step {
        display: flex;
        align-items: center;
        background-color: var(--color-surface);
        border: 2px solid var(--color-border-light);
        border-radius: 50px;
        padding: 8px 16px;
        transition: all 0.4s ease;
        color: var(--color-text-muted);
        font-weight: 600;
        flex-grow: 1;
        justify-content: center;
        position: relative;
        gap: 8px;
      }

      .progress-step:not(:last-child) {
        margin-left: 20px;
      }

      .progress-step:not(:last-child)::after {
        content: "";
        position: absolute;
        top: 50%;
        left: -22px;
        transform: translateY(-50%);
        width: 20px;
        height: 2px;
        background-color: var(--color-border-light);
        transition: background-color 0.4s ease;
      }

      .step-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background-color: var(--color-border-light);
        color: var(--color-text-muted);
        font-weight: 700;
        font-size: 0.9rem;
        transition: all 0.4s ease;
      }

      .step-icon svg {
        width: 16px;
        height: 16px;
        color: var(--color-surface);
        display: none;
      }

      .progress-step.completed,
      .progress-step.active {
        background-color: var(--color-primary);
        border-color: var(--color-primary);
        color: var(--color-text-on-primary);
      }

      .progress-step.completed > span.step-icon > svg {
        color: var(--color-primary) !important;
      }

      .progress-step.completed .step-icon,
      .progress-step.active .step-icon {
        background-color: var(--color-surface);
        color: var(--color-primary) !important;
      }

      .progress-step.completed .step-icon .step-number {
        display: none;
      }

      .progress-step.completed .step-icon svg {
        display: block;
      }

      .progress-step.completed:not(:last-child)::after {
        background-color: var(--color-primary);
      }

      .step {
        display: none;
        animation: fadeIn 0.5s ease-in-out;
      }

      .step.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card {
        background: var(--color-surface);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px var(--shadow-sm);
        border: 2px solid var(--color-surface);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        text-align: right;
      }

      .card:hover:not(:has(.card)) {
        border-color: var(--color-primary-light);
        box-shadow: 0 8px 25px var(--shadow-primary-lg);
      }

      .card-title {
        font-size: 1.4rem;
        color: var(--color-text-strong);
        margin-bottom: 20px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .card-title .icon {
        font-size: 1.2rem;
      }

      .card-title-text {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .meal-section.card {
        margin-bottom: 30px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .meal-title {
        font-size: 1.5rem;
        color: var(--color-primary);
        margin-bottom: 0px;
        font-weight: 600;
      }

      #extraServicesContainer,
      .shabbat-morning-choice,
      .custom-selection-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .options-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .option-card {
        border: 2px solid var(--color-border);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        background: var(--color-surface);
        position: relative;
        overflow: hidden;
        text-align: right;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        padding: 0;
        gap: 0;
      }

      .option-card:hover {
        border-color: var(--color-primary-light);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px var(--shadow-primary-lg);
      }

      .option-card.selected {
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px var(--color-primary);
        flex-direction: row;
      }

      .option-card.selected::after {
        content: "âœ“";
        position: absolute;
        top: 10px;
        left: 10px;
        background: var(--color-primary);
        color: var(--color-text-on-primary);
        width: 25px;
        height: 25px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.8rem;
        z-index: 2;
      }

      img.option-card-image {
        width: 100%;
        height: 250px;
        max-width: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
        border-radius: 0 !important;
        flex-shrink: 0;
      }

      .option-card:hover img.option-card-image {
        transform: scale(1.05);
      }

      .option-card.selected img.option-card-image {
        width: 200px;
      }

      .option-card-content {
        padding: 20px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .option-title {
        font-size: 1.3rem;
        color: var(--color-text-strong);
        margin-bottom: 10px;
        font-weight: 600;
      }

      .option-description-list {
        list-style: none;
        padding: 0;
        margin: 0 0 15px 0;
        font-size: 1rem;
        color: var(--color-text-default);
        flex-grow: 1;
      }

      .option-description-list li {
        display: flex;
        align-items: flex-start;
        gap: 8px;
        margin-bottom: 6px;
        line-height: 1.4;
      }

      .option-description-list li .emoji {
        line-height: 1.4;
      }

      .option-price {
        font-size: 1.5rem;
        color: var(--color-primary);
        font-weight: bold;
        margin-top: auto;
      }

      .selection-section {
        margin-bottom: 0px;
      }

      .selection-title {
        font-size: 1.2rem;
        color: var(--color-text-strong);
        margin-bottom: 15px;
        font-weight: 600;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .selection-controls {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .selection-counter {
        background: var(--color-border);
        color: var(--color-text-muted);
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .selection-counter.completed {
        background: var(--color-primary);
        color: var(--color-text-on-primary);
      }

      .items-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 12px;
      }

      .item-card {
        background: var(--color-background);
        border: 2px solid var(--color-border);
        border-radius: 8px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        text-align: right;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
        justify-content: space-between;
      }

      .item-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--color-text-strong);
        line-height: 1.4;
        flex-grow: 1;
      }

      .item-price {
        color: var(--color-primary);
        font-weight: 700;
        font-size: 1.1rem;
        margin-top: auto;
      }

      .item-card-footer {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        margin-top: 10px;
      }

      .item-quantity-selector {
        display: flex;
        align-items: center;
        gap: 10px;
        background: var(--color-surface);
        border: 1px solid var(--color-border-light);
        border-radius: 50px;
        padding: 2px;
      }

      .item-quantity-btn {
        background: var(--color-primary);
        color: var(--color-text-on-primary);
        border: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s;
        padding: 16px !important;
        touch-action: manipulation;
      }

      .item-quantity-btn:hover {
        background: var(--color-primary-light);
      }

      .item-quantity-value {
        font-weight: 700;
        font-size: 0.9rem;
        min-width: 20px;
        text-align: center;
      }

      .item-card.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background: var(--color-border);
      }

      .item-card:not(.disabled):hover {
        border-color: var(--color-primary-light);
        background: var(--color-surface);
        transform: translateY(-2px);
      }

      .item-card.selected {
        border-color: var(--color-primary);
        background: var(--color-primary-faint);
        color: var(--color-primary);
      }

      .item-card.selected::after {
        content: "âœ“";
        position: absolute;
        top: -5px;
        left: -5px;
        background: var(--color-primary);
        color: var(--color-text-on-primary);
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.7rem;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--color-text-strong);
        text-align: right;
      }

      .form-input {
        width: 100%;
        padding: 12px 15px !important;
        border: 2px solid var(--color-border) !important;
        border-radius: 8px !important;
        font-size: 1rem !important;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) !important;
        font-family: "Assistant", sans-serif !important;
        background-color: var(--color-background);
        color: var(--color-text-strong);
      }

      .form-input:focus {
        outline: none !important;
        border-color: var(--color-primary-light) !important;
        box-shadow: 0 0 0 4px var(--shadow-primary-lg) !important;
      }

      #phone {
        text-align: right;
        direction: ltr;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .form-group-checkbox {
        display: flex;
        align-items: center;
        gap: 10px;
        background-color: var(--color-background);
        padding: 15px;
        border-radius: 8px;
        cursor: pointer;
      }

      .form-group-checkbox input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: var(--color-primary);
        flex-shrink: 0;
      }

      .form-group-checkbox label {
        font-weight: 600;
        color: var(--color-text-strong);
        margin: 0;
      }

      .quantity-input {
        display: flex;
        align-items: center;
        gap: 15px;
        background: var(--color-surface);
        border: 2px solid var(--color-border);
        border-radius: 50px;
        padding: 5px 10px;
        max-width: 100%;
        width: auto;
        align-self: flex-start;
        justify-self: flex-start;
      }

      .quantity-btn {
        background: var(--color-primary);
        color: var(--color-text-on-primary);
        border: none;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        width: 48px;
        aspect-ratio: 1 / 1;
        height: auto;
        max-width: 100%;
        touch-action: manipulation;
      }

      .quantity-btn:hover {
        background: var(--color-primary-light);
        transform: scale(1.1);
      }

      .quantity-value {
        font-size: 1.1rem;
        font-weight: bold;
        text-align: center;
        border: none;
        background: transparent;
        width: 50px !important;
        padding: 0 !important;
        color: var(--color-text-strong);
      }

      .quantity-value:focus {
        outline: none;
      }

      /* Hide number input spinners */
      .quantity-value::-webkit-outer-spin-button,
      .quantity-value::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      .quantity-value[type="number"] {
        -moz-appearance: textfield;
      }

      .nav-buttons {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 10px;
        background: var(--color-surface);
        border-radius: 12px;
        box-shadow: 0 4px 15px var(--shadow-sm);
        border: 1px solid var(--color-border);
      }

      .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 50px;
        /* Pill shape */
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        font-weight: 700;
        letter-spacing: 0.5px;
        touch-action: manipulation;
      }

      .btn-primary {
        background: linear-gradient(
          120deg,
          var(--color-primary) 0%,
          var(--color-primary-light) 100%
        );
        color: var(--color-text-on-primary);
        box-shadow: 0 4px 15px var(--shadow-primary-sm);
      }

      .btn-primary:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px var(--shadow-primary-md);
        background: linear-gradient(
          120deg,
          var(--color-primary-dark) 0%,
          var(--color-primary) 100%
        );
      }

      .btn-secondary {
        background: var(--color-background);
        color: var(--color-text-default);
        border: 2px solid var(--color-border);
      }

      .btn-secondary:hover {
        background: var(--color-border);
        transform: translateY(-2px);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn-small {
        padding: 8px 18px;
        font-size: 0.9rem;
        font-weight: 600;
      }

      /* Sidebar Styles */
      .order-summary {
        background: var(--color-surface);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 15px var(--shadow-sm);
      }

      .summary-title {
        font-size: 1.4rem;
        color: var(--color-text-strong);
        margin-bottom: 20px;
        font-weight: 600;
        text-align: center;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--color-border);
      }

      .summary-section {
        margin-bottom: 20px;
      }

      .summary-section-title {
        font-size: 1.1rem;
        color: var(--color-primary);
        margin-bottom: 10px;
        font-weight: 600;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
        font-size: 0.9rem;
      }

      .summary-item:last-child {
        border-bottom: none;
      }

      .summary-item-name {
        flex: 1;
        padding-left: 10px;
        text-align: right;
        color: var(--color-text-default);
      }

      .summary-item-price {
        color: var(--color-primary);
        font-weight: bold;
        white-space: nowrap;
      }

      .summary-total {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 2px solid var(--color-primary);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.3rem;
        font-weight: bold;
        color: var(--color-primary);
      }

      .summary-quantity {
        background: var(--color-primary-faint);
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        margin-bottom: 20px;
      }

      .summary-quantity-value {
        font-size: 2rem;
        font-weight: bold;
        color: var(--color-primary);
      }

      .summary-quantity-label {
        font-size: 0.9rem;
        color: var(--color-text-default);
      }

      .feedback-alert {
        background: var(--color-feedback-background);
        color: var(--color-feedback-text);
        border: 1px solid var(--color-feedback-border);
        padding: 10px 20px;
        border-radius: 50px;
        display: none;
        font-weight: 600;
        text-align: center;
        flex-grow: 1;
        margin: 0 20px;
      }

      .special-note {
        background: var(--color-feedback-background);
        color: var(--color-feedback-text);
        border: 1px solid var(--color-feedback-border);
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        font-weight: 600;
        text-align: center;
      }

      /* Date Chips Styles */
      .date-chips-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 10px;
        justify-content: flex-start;
      }

      .date-chip {
        padding: 10px 15px;
        border: 2px solid var(--color-border);
        border-radius: 50px;
        color: var(--color-text-default);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        text-align: center;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 5px;
      }

      .date-chip:hover {
        border-color: var(--color-primary-light);
        background: var(--color-background);
      }

      .date-chip.selected {
        border-color: var(--color-primary);
        background: var(--color-primary);
        color: var(--color-text-on-primary);
        box-shadow: 0 4px 10px var(--shadow-primary-sm);
      }

      .date-chip .day-name {
        font-weight: 600;
        font-size: 0.9rem;
      }

      .date-chip .date-str {
        font-size: 0.8rem;
      }

      .date-chip .today-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: var(--color-danger);
        color: var(--color-text-on-primary);
        font-size: 0.6rem;
        padding: 2px 5px;
        border-radius: 10px;
        font-weight: bold;
      }

      .custom-date-container {
        margin-top: 15px;
      }

      /* Modal Styles */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--color-overlay);
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        display: flex;
      }

      .modal-overlay.visible {
        opacity: 1;
        visibility: visible;
      }

      .modal-content {
        background: var(--color-surface);
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 500px;
        text-align: center;
        transform: scale(0.9);
        transition: transform 0.3s ease;
      }

      .modal-overlay.visible .modal-content {
        transform: scale(1);
      }

      .modal-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px;
        background: var(--color-primary-faint);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-icon svg {
        width: 50px;
        height: 50px;
        color: var(--color-primary);
      }

      .modal-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--color-text-strong);
        margin-bottom: 10px;
      }

      .modal-description {
        color: var(--color-text-default);
        margin-bottom: 20px;
      }

      .whatsapp-summary-textarea {
        width: 100%;
        height: 150px;
        padding: 10px;
        border: 2px solid var(--color-border);
        border-radius: 8px;
        color: var(--color-text-strong);
        resize: none;
        font-size: 0.9rem;
        background: var(--color-background);
        margin-bottom: 20px;
        direction: rtl;
        text-align: right;
      }

      .modal-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .btn-whatsapp {
        background: var(--color-whatsapp);
        color: var(--color-text-on-primary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-whatsapp:hover {
        background: var(--color-whatsapp-hover);
        box-shadow: 0 4px 15px var(--shadow-whatsapp);
      }

      /* --- MOBILE NAV BAR --- */
      .mobile-nav-bar {
        display: none;
        /* Hidden by default */
      }

      .mobile-summary {
        display: none;
      }

      /* --- NEW --- Feedback Indicator */
      .feedback-indicator {
        display: none;
        /* Hidden by default */
        width: 10px;
        height: 10px;
        background-color: var(--color-indicator);
        border-radius: 50%;
        margin-left: 8px;
        /* Space from the text/button */
        animation: pulse 1.5s infinite;
      }

      /* --- NEW --- Theme Toggle Button */
      .theme-toggle-btn {
        background-color: var(--color-border);
        border: 2px solid transparent;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 0px !important;
      }

      .theme-toggle-btn:hover {
        border-color: var(--color-primary);
      }

      .theme-toggle-btn svg {
        width: 20px;
        height: 20px;
        color: var(--color-text-strong);
      }

      html.dark .theme-toggle-btn .sun-icon {
        display: block;
      }

      html.dark .theme-toggle-btn .moon-icon {
        display: none;
      }

      html:not(.dark) .theme-toggle-btn .sun-icon {
        display: none;
      }

      html:not(.dark) .theme-toggle-btn .moon-icon {
        display: block;
      }

      @keyframes pulse {
        0% {
          transform: scale(0.95);
          box-shadow: 0 0 0 0 var(--shadow-indicator);
        }

        70% {
          transform: scale(1);
          box-shadow: 0 0 0 10px var(--shadow-indicator-end);
        }

        100% {
          transform: scale(0.95);
          box-shadow: 0 0 0 0 var(--shadow-indicator-end);
        }
      }

      @media (max-width: 1024px) {
        .container {
          grid-template-columns: 1fr;
        }

        .sidebar {
          display: none;
          /* Hide sidebar on mobile */
        }

        .main-content {
          padding-bottom: 120px;
          /* Space for mobile nav */
        }

        .nav-buttons {
          display: none;
          /* Hide desktop nav buttons */
        }

        .mobile-nav-bar {
          display: flex;
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          background: rgba(255, 255, 255, 0.8);
          backdrop-filter: blur(10px);
          -webkit-backdrop-filter: blur(10px);
          border-top: 1px solid var(--color-border);
          padding: 15px 20px;
          justify-content: space-between;
          align-items: center;
          z-index: 100;
        }

        html.dark .mobile-nav-bar {
          background: rgba(31, 41, 55, 0.8);
        }

        .mobile-nav-total {
          font-size: 1.2rem;
          font-weight: 700;
          color: var(--color-text-strong);
        }

        .mobile-nav-buttons {
          display: flex;
          gap: 10px;
        }

        .mobile-summary {
          display: block;
        }
      }

      @media (max-width: 768px) {
        .main-content,
        .sidebar {
          padding: 20px;
        }

        .options-grid {
          grid-template-columns: 1fr;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .items-grid {
          grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        }

        .item-card-footer {
          flex-direction: column;
          align-items: flex-start;
        }

        .item-quantity-selector {
          padding: 4px;
          width: 100%;
          justify-content: space-around;
        }

        .option-card {
          flex-direction: column;
        }

        .option-card.selected {
          flex-direction: column;
        }

        .option-card.selected img.option-card-image {
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="main-content">
        <header class="form-header-main">
          <div class="form-header">
            <div class="header-logo">
              <!-- Replace with your logo -->
              <a
                href="/"
                style="
                  display: flex;
                  justify-content: center;
                  align-items: center;
                  gap: 10px;
                "
              >
                <img
                  width="100"
                  src="https://www.agada-c.co.il/wp-content/uploads/2022/05/Untitled-2-1.png"
                  alt="×§×™×™×˜×¨×™× ×’ ××’×“×” ×œ×•×’×•"
                />
                <h1 class="title">×”×–×× ×ª ×§×™×™×˜×¨×™× ×’</h1>
              </a>
            </div>
            <div class="header-contact">
              <!-- Theme Toggle -->
              <button id="themeToggleBtn" class="theme-toggle-btn">
                <svg
                  id="Sun"
                  class="sun-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M12.0548 3V4.3719M12.0548 19.6281V21M21.0547 12.0001H19.6828M4.42659 12.0001H3.05469M18.4185 5.63582L17.4485 6.60589M6.66105 17.3938L5.69099 18.3639M18.4185 18.3639L17.4485 17.3938M6.66105 6.60636L5.69099 5.6363"
                    stroke="#ffffff"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  ></path>
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M12.0549 7.80469C14.3725 7.80469 16.2504 9.68351 16.2504 12.0002C16.2504 14.3178 14.3725 16.1966 12.0549 16.1966C9.73723 16.1966 7.85938 14.3178 7.85938 12.0002C7.85938 9.68351 9.73723 7.80469 12.0549 7.80469Z"
                    stroke="#ffffff"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  ></path>
                </svg>
                <svg
                  class="moon-icon"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-3.51 1.713-6.635 4.398-8.552a.75.75 0 01.819.162z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
              </button>
            </div>
          </div>
          <div class="progress-bar">
            <div class="progress-step active" data-step="1">
              <span class="step-icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                  ></path>
                </svg>
                <span class="step-number">1</span>
              </span>
              <span class="step-label">×”×¨×›×‘×ª ×ª×¤×¨×™×˜</span>
            </div>
            <div class="progress-step" data-step="2">
              <span class="step-icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                  ></path>
                </svg>
                <span class="step-number">2</span>
              </span>
              <span class="step-label">×¤×¨×˜×™ ×”×–×× ×”</span>
            </div>
          </div>
        </header>

        <!-- ×©×œ×‘ 1: ×”×¨×›×‘×ª ×ª×¤×¨×™×˜ (×‘×—×™×¨×ª ×—×‘×™×œ×” ×•×”×¨×›×‘×ª ×× ×•×ª) -->
        <div class="step active" id="step1">
          <div class="card" id="menuCard">
            <div class="card-title">
              <div class="card-title-text">
                <span class="icon">ğŸ½ï¸</span>×‘×—×¨×• ××ª ×”×ª×¤×¨×™×˜ ×”××ª××™×
              </div>
              <button
                class="btn btn-secondary btn-small"
                id="changeMenuBtn"
                style="display: none"
              >
                ×©× ×” ×ª×¤×¨×™×˜
              </button>
            </div>
            <div id="menuOptions" class="options-grid">
              <!-- All menu packages will be dynamically inserted here -->
            </div>
          </div>
          <div class="card" id="quantityCard" style="display: none">
            <div class="form-group" style="margin-bottom: 0">
              <label
                class="card-title-text"
                style="font-size: 1.4rem; font-weight: 600"
                >×›××•×ª ×× ×•×ª</label
              >
              <div class="quantity-input">
                <button type="button" class="quantity-btn" id="quantity-minus">
                  âˆ’
                </button>
                <input
                  type="number"
                  class="quantity-value"
                  id="quantityValue"
                  value="30"
                  min="30"
                />
                <button type="button" class="quantity-btn" id="quantity-plus">
                  +
                </button>
              </div>
            </div>
          </div>
          <div id="menuComposition">
            <!-- Menu composition sections will be dynamically inserted here -->
          </div>
          <div id="specialNoteContainer" style="display: none">
            <div class="special-note">
              ğŸ ×›×œ ×”××–××™×Ÿ ×©×‘×ª ××œ××” 50 ×× ×•×ª ×•××¢×œ×” ××§×‘×œ ××ª× ×” ×§×¦×™×¦×•×ª ×“×’×™× ×¡×œ×•××•×Ÿ
              ×‘×¨×•×˜×‘ ××–×¨×—×™ ×¢×‘×•×“×ª ×™×“!
            </div>
          </div>
          <div class="card" id="extraServicesCard" style="display: none">
            <div class="card-title">
              <div class="card-title-text">
                <span class="icon">ğŸ‚</span>×ª×•×¡×¤×•×ª ×•×©×™×¨×•×ª×™× (××•×¤×¦×™×•× ×œ×™)
              </div>
            </div>
            <div id="extraServicesContainer"></div>
          </div>
        </div>

        <!-- ×©×œ×‘ 2: ×¤×¨×˜×™ ×”×–×× ×” -->
        <div class="step" id="step2">
          <div class="card">
            <div class="card-title">
              <div class="card-title-text">
                <span class="icon">ğŸ‘¤</span>×¤×¨×˜×™ ×§×©×¨
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="fullName">×©× ××œ× *</label>
                <input type="text" class="form-input" id="fullName" required />
              </div>
              <div class="form-group">
                <label class="form-label" for="phone">×˜×œ×¤×•×Ÿ *</label>
                <input type="tel" class="form-input" id="phone" required />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="address">×›×ª×•×‘×ª *</label>
              <input type="text" class="form-input" id="address" required />
            </div>
            <div class="form-group">
              <label class="form-label">×ª××¨×™×š ×”××™×¨×•×¢ *</label>
              <div class="date-chips-container" id="dateChipsContainer"></div>
              <div
                class="custom-date-container"
                id="customDateContainer"
                style="display: none"
              >
                <input type="date" class="form-input" id="eventDateCustom" />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="notes">×”×¢×¨×•×ª</label>
              <textarea
                class="form-input"
                id="notes"
                rows="3"
                placeholder="×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×œ×’×‘×™ ×”××™×¨×•×¢..."
              ></textarea>
            </div>
          </div>
          <div class="order-summary mobile-summary">
            <div class="summary-title">×¡×™×›×•× ×”×”×–×× ×”</div>
            <div class="summary-quantity">
              <div class="summary-quantity-value summaryQuantity">30</div>
              <div class="summary-quantity-label">×× ×•×ª</div>
            </div>
            <div class="order-summary-content">
              <div style="text-align: center; color: #666; padding: 20px">
                ×‘×—×¨×• ×—×‘×™×œ×ª ×ª×¤×¨×™×˜ ×œ×”×ª×—×œ×”
              </div>
            </div>
            <div class="summary-total" style="display: none">
              <span>×¡×”"×›:</span>
              <span class="total-price">â‚ª0</span>
            </div>
          </div>
        </div>
      </div>

      <div class="sidebar">
        <div class="nav-buttons">
          <button class="btn btn-secondary" id="prevBtn" style="display: none">
            ×”×§×•×“×
          </button>
          <div
            class="feedback-alert"
            id="feedbackAlert"
            style="display: none"
          ></div>
          <button class="btn btn-primary" id="nextBtn">×”×‘×</button>
        </div>
        <div class="order-summary">
          <div class="summary-title">×¡×™×›×•× ×”×”×–×× ×”</div>
          <div class="summary-quantity">
            <div class="summary-quantity-value summaryQuantity">30</div>
            <div class="summary-quantity-label">×× ×•×ª</div>
          </div>
          <div class="order-summary-content">
            <div style="text-align: center; color: #666; padding: 20px">
              ×‘×—×¨×• ×—×‘×™×œ×ª ×ª×¤×¨×™×˜ ×œ×”×ª×—×œ×”
            </div>
          </div>
          <div class="summary-total" style="display: none">
            <span>×¡×”"×›:</span>
            <span class="total-price">â‚ª0</span>
          </div>
        </div>
      </div>

      <!-- Mobile Nav Bar -->
      <div class="mobile-nav-bar">
        <div class="mobile-nav-total">
          <span id="mobileTotalPrice">â‚ª0</span>
        </div>
        <div class="mobile-nav-buttons">
          <button
            class="btn btn-secondary"
            id="mobilePrevBtn"
            style="display: none"
          >
            ×”×§×•×“×
          </button>
          <button class="btn btn-primary" id="mobileNextBtn">×”×‘×</button>
        </div>
      </div>

      <!-- Success Modal -->
      <div class="modal-overlay" id="successModal">
        <div class="modal-content">
          <div class="modal-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
              ></path>
            </svg>
          </div>
          <h3 class="modal-title">×”×”×–×× ×” × ×©×œ×—×” ×‘×”×¦×œ×—×”!</h3>
          <p class="modal-description">
            × ×¦×™×’ ×™×—×–×•×¨ ××œ×™×›× ×‘×”×§×“×. × ×™×ª×Ÿ ×œ×©×œ×•×— ×¡×™×›×•× ×‘×•×•××˜×¡××¤ ×œ×ª×™×¢×•×“.
          </p>
          <textarea
            id="whatsappSummary"
            class="whatsapp-summary-textarea"
            readonly
          ></textarea>
          <div class="modal-actions">
            <button class="btn btn-secondary" id="copyBtn">×”×¢×ª×§ ×¡×™×›×•×</button>
            <button class="btn btn-whatsapp" id="whatsappBtn">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.687-1.475L.057 24zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.5-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.227 1.36.195 1.871.118.571-.078 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"
                ></path>
              </svg>
              <span>×©×œ×— ×‘-WhatsApp</span>
            </button>
            <button class="btn btn-secondary" id="closeModalBtn">×¡×’×•×¨</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DATA SOURCE ---
        const cateringData = {
          packages: [
            {
              id: "reg_48",
              name: "××’×“×ª ×”×“×’×™×",
              price: 48,
              description: [
                "8 ×¡×•×’×™ ×¡×œ×˜×™× ×œ×‘×—×™×¨×”",
                "2 ×× ×•×ª ×¨××©×•× ×•×ª ×›×•×œ×œ ×¤×™×œ×” ×¡×œ×•××•×Ÿ",
                "3 ×ª×•×¡×¤×•×ª ×—××•×ª",
                "×œ×—×× ×™×•×ª ×•×¤×¨× ×•×ª ×¢×‘×•×“×ª ×™×“",
              ],
              structure: [
                {
                  name: "×ª×¤×¨×™×˜ ×¢×™×§×¨×™",
                  salads: 8,
                  firstCourses: 2,
                  sides: 3,
                  breads: 2,
                },
              ],
              image:
                "https://www.agada-c.co.il/wp-content/uploads/2025/08/freepik__the-style-is-candid-image-photography-with-natural__2426.png",
            },
            {
              id: "reg_53",
              name: "××’×“×ª ×”×‘×©×¨×™×",
              price: 53,
              description: [
                "8 ×¡×•×’×™ ×¡×œ×˜×™× ×œ×‘×—×™×¨×”",
                "3 ×× ×•×ª ×¢×™×§×¨×™×•×ª (×¦×œ×™ ×›×ª×£, ××¡××“×•, ×¤×¨×’×™×ª)",
                "3 ×ª×•×¡×¤×•×ª ×—××•×ª",
                "×œ×—×× ×™×•×ª ×•×¤×¨× ×•×ª ×¢×‘×•×“×ª ×™×“",
              ],
              structure: [
                {
                  name: "×ª×¤×¨×™×˜ ×¢×™×§×¨×™",
                  salads: 8,
                  mainCourses: 3,
                  sides: 3,
                  breads: 2,
                },
              ],
              image:
                "https://www.agada-c.co.il/wp-content/uploads/2025/08/××’×“×ª-×”×‘×©×¨×™×-×ª××•× ×”-×¨××©×™×ª.png",
            },
            {
              id: "reg_68",
              name: "×”××’×“×” ×”××•×©×œ××ª",
              price: 68,
              image:
                "https://www.agada-c.co.il/wp-content/uploads/2025/08/freepik__enhance__10857-scaled.png",
              description: [
                "8 ×¡×•×’×™ ×¡×œ×˜×™× ×œ×‘×—×™×¨×”",
                "2 ×× ×•×ª ×¨××©×•× ×•×ª (×¡×œ×•××•×Ÿ, ×¨×•×œ ×‘×©×¨)",
                "3 ×× ×•×ª ×¢×™×§×¨×™×•×ª (×¦×œ×™ ×›×ª×£, ××¡××“×•, ×¤×¨×’×™×ª)",
                "3 ×ª×•×¡×¤×•×ª ×—××•×ª",
                "×œ×—×× ×™×•×ª ×•×¤×¨× ×•×ª ×¢×‘×•×“×ª ×™×“",
              ],
              structure: [
                {
                  name: "×ª×¤×¨×™×˜ ×¢×™×§×¨×™",
                  salads: 8,
                  firstCourses: 2,
                  mainCourses: 3,
                  sides: 3,
                  breads: 2,
                },
              ],
            },
            {
              id: "shabbat_full",
              name: "××’×“×ª ×”×©×‘×ª",
              price: 140,
              image:
                "https://www.agada-c.co.il/wp-content/uploads/2025/08/freepik__the-style-is-candid-image-photography-with-natural__2425.png",
              description: [
                "×›×•×œ×œ 3 ×¡×¢×•×“×•×ª ××œ××•×ª",
                "×¡×œ×˜×™× ×˜×¨×™×™× ×œ×›×œ ×”×¡×¢×•×“×•×ª",
                "×œ×—×× ×™×•×ª ×•×¤×¨× ×•×ª ×¢×‘×•×“×ª ×™×“",
              ],
              structure: [
                {
                  name: "×¡×œ×˜×™× (×œ×›×œ ×”×¡×¢×•×“×•×ª)",
                  salads: 8,
                },
                {
                  name: "×œ×™×œ ×©×‘×ª",
                  firstCourses: 2,
                  mainCourses: 3,
                  sides: 3,
                  breads: 2,
                },
                {
                  name: "×©×‘×ª ×‘×‘×•×§×¨",
                  included: ["×¡×œ×˜×™×", "×œ×—×× ×™×•×ª ×•×¤×¨× ×•×ª"],
                  type: "choice", // Special type for the morning meal choice
                  options: {
                    cholent: {
                      name: "×—×‘×™×œ×ª ×—××™×Ÿ ×¢×©×™×¨",
                      description: "×‘×©×¨ ×‘×©×¤×¢, ××•×¨×–, ×—×™×˜×”, ×‘×™×¦×™× ×•×©× ×™×¦×œ×•× ×™×.",
                    },
                    custom: {
                      name: "×ª×•×¡×¤×•×ª ×•×× ×” ×¢×™×§×¨×™×ª",
                      description: "×‘×—×™×¨×” ×©×œ 3 ×ª×•×¡×¤×•×ª ×•-3 ×× ×•×ª ×¢×™×§×¨×™×•×ª.",
                      sides: 3,
                      mainCoursesShabbat: 3, // Using the filtered list
                    },
                  },
                },
                {
                  name: "×¡×¢×•×“×” ×©×œ×™×©×™×ª",
                  included: ["×¡×œ×˜×™×", "×¤×©×˜×™×“×”", '×‘×•×¨×§×¡ ×ª×¤×•"×'],
                  thirdMealFish: 1, // Using the specific fish list
                },
              ],
            },
          ],
          menuItems: {
            firstCourses: {
              name: "×× ×•×ª ×¨××©×•× ×•×ª",
              emoji: "ğŸŸ",
              items: [
                {
                  name: "×¤×™×œ×” ××•×©×˜ ××–×¨×—×™ - ×‘×¨×•×˜×‘ ×¢×’×‘× ×™×•×ª, ×¤×œ×¤×œ ×©×•× ×•×’×¨×’×¨×™ ×—×•××•×¡.",
                },
                {
                  name: "×¤×™×œ×” ××•×©×˜ ××˜×•×’×Ÿ â€“ ××•×’×© ×œ×¦×“ ×¨×•×˜×‘ ×¦'×¨××œ×” ×¤×™×§× ×˜×™ ×•×¤×œ×—×™ ×œ×™××•×Ÿ.",
                },
                { name: "×¡×•×œ ××˜×•×’×Ÿ â€“ ××•×’×© ×œ×¦×“ ×¨×•×˜×‘ ×¦'×¨××œ×”." },
                {
                  name: "×¡×œ×•××•×Ÿ ××–×¨×—×™ â€“ ×¤×™×œ×” ×¡×œ×•××•×Ÿ ×˜×¨×™ ×‘×¨×•×˜×‘ ×¢×©×™×¨ ×©×œ ×›×•×¡×‘×¨×” ×¤×œ×¤×œ×™× ×©×•× ×•×—×•××•×¡ ××‘×•×©×œ.",
                },
                {
                  name: "×¡×œ××•×Ÿ ×‘×¢×©×‘×™ ×ª×™×‘×•×œ â€“ ×¤×™×œ×” ×¡×œ×•××•×Ÿ ×¢×¡×™×¡×™ ×‘×¢×©×‘×™ ×ª×™×‘×•×œ ×˜×¨×™×™×, ×©×•× ×•×—×¨×“×œ.",
                },
                { name: "×“×’ × ×¡×™×›×” ××–×¨×—×™ ×‘×¡×’× ×•×Ÿ ××¨×•×§××™" },
                { name: '×‘×•×¨×§×¡ ×ª×¤×•"×- ×‘×¨×•×˜×‘ ×¤×˜×¨×™×•×ª' },
                { name: "×××¤×” ×”×©×£" },
                { name: "×˜×•×¨×˜×™×” ××§×¡×™×§× ×™×ª - ×‘××™×œ×•×™ ×‘×©×¨ ×¢×’×œ â€“ ××•××œ×¥!." },
                { name: "×˜×•×¨×˜×™×” ××§×¡×™×§× ×™×ª ×‘××™×œ×•×™ ×™×¨×§×•×ª â€“ ×× ×” ×˜×‘×¢×•× ×™×ª." },
                { name: "×¨×•×œ ×‘×©×¨ ×¢×‘×•×“×ª ×™×“" },
              ],
            },
            mainCourses: {
              name: "×× ×•×ª ×¢×™×§×¨×™×•×ª",
              emoji: "ğŸ–",
              items: [
                { name: "×’×¨×™×œ ×¢×•×£ â€“ ×›×¨×¢×™×™× ×¦×œ×•×™×•×ª" },
                { name: "×—×¦××™ ×›×¨×¢×™×™×" },
                { name: "×¡×˜×™×™×§ ×¤×¨×’×™×ª ××¨×•×š ×¢×œ ×”××©" },
                {
                  name: "×©× ×™×¦×œ ×•×™× ××™ â€“ ×©× ×™×¦×œ ×¢×•×£ ×¤×¨×™×š ×•×–×”×•×‘ ××ª×•×‘×œ ×‘×¤×¨×•×¨×™ ×œ×—× ×•×©×•××©×•×",
                },
                { name: "×—×¦××™ ×©× ×™×¦×œ" },
                { name: "×¦×œ×™ ×›×ª×£ ××¨×’× ×˜×™× ××™ ×˜×¨×™" },
                { name: "×œ×©×•×Ÿ ×‘×¨×•×˜×‘" },
                { name: "××¡××“×• â€“ × ×ª×—×™ ××¡××“×• ××¨×’× ×˜×™× ××™ ×‘×‘×™×©×•×œ ××™×˜×™" },
                {
                  name: "×§×‘×‘ ××’×“×” â€“ ×©×™×¤×•×“×™ ×§×‘×‘ ×‘×¢×‘×•×“×ª ×™×“ ×¢×¡×™×¡×™×™× ×¢×œ ×”××© â€“ ××•××œ×¥!.",
                },
                { name: "×©×™×¤×•×“×™ ×¢×•×£ ×¢×œ ×”××©" },
                { name: "×—×–×” ×¢×•×£" },
              ],
            },
            mainCoursesShabbat: {
              // Filtered list for Shabbat morning
              name: "×× ×•×ª ×¢×™×§×¨×™×•×ª (×©×‘×ª ×‘×‘×•×§×¨)",
              emoji: "ğŸ–",
              items: [
                { name: "×’×¨×™×œ ×¢×•×£ â€“ ×›×¨×¢×™×™× ×¦×œ×•×™×•×ª" },
                { name: "×—×¦××™ ×›×¨×¢×™×™×" },
                { name: "×¡×˜×™×™×§ ×¤×¨×’×™×ª ××¨×•×š ×¢×œ ×”××©" },
                {
                  name: "×©× ×™×¦×œ ×•×™× ××™ â€“ ×©× ×™×¦×œ ×¢×•×£ ×¤×¨×™×š ×•×–×”×•×‘ ××ª×•×‘×œ ×‘×¤×¨×•×¨×™ ×œ×—× ×•×©×•××©×•×",
                },
                { name: "×—×¦××™ ×©× ×™×¦×œ" },
                { name: "×œ×©×•×Ÿ ×‘×¨×•×˜×‘" },
                {
                  name: "×§×‘×‘ ××’×“×” â€“ ×©×™×¤×•×“×™ ×§×‘×‘ ×‘×¢×‘×•×“×ª ×™×“ ×¢×¡×™×¡×™×™× ×¢×œ ×”××© â€“ ××•××œ×¥!.",
                },
                { name: "×©×™×¤×•×“×™ ×¢×•×£ ×¢×œ ×”××©" },
                { name: "×—×–×” ×¢×•×£" },
              ],
            },
            sides: {
              name: "×ª×•×¡×¤×•×ª",
              emoji: "ğŸš",
              items: [
                { name: "××•×¨×– ×œ×‘×Ÿ ×¢× ×©×§×“×™× ×•×¦×™××•×§×™×" },
                { name: '×ª×¤×•"× ×‘×™×™×‘×™ ×‘×¢×©×‘×™ ×ª×™×‘×•×œ ×•×¨×•×–××¨×™×Ÿ' },
                { name: "×–×™×ª×™× ×¢× ×¤×˜×¨×™×•×ª ×‘×¡×’× ×•×Ÿ ××¨×•×§××™" },
                { name: "××¨×˜×™×©×•×§ ×‘×¨×•×˜×‘, ×¤×˜×¨×™×•×ª ×©×œ××•×ª ×•×‘×¦×œ" },
                { name: "××¤×•× ×” ×•×’×–×¨" },
                {
                  name: "×™×¨×§×•×ª ××•×§×¤×¦×™× â€“ ×¤×œ×¤×œ×™×, ×¤×˜×¨×™×•×ª ×©×œ××•×ª, ×’×–×¨, ×§×™×©×•× ××•×§×¤×¥ ×‘×¨×•×˜×‘ ×¢× ×©×•××©×•×.",
                },
                { name: "×©×¢×•×¢×™×ª ×‘×¨×•×˜×‘ ×¤×™×§× ×˜×™" },
                { name: "×©×¢×•×¢×™×ª ×™×¨×•×§×” ××•×§×¤×¦×ª â€“ ×¢× ×˜×¨×™××§×™ ×•×©×•××©×•×" },
                { name: "×§×•×¡×§×•×¡ ××¨×•×§××™" },
                { name: "×œ×§×˜ ×™×¨×§×•×ª ××‘×•×©×œ×™× ×œ×§×•×¡×§×•×¡" },
              ],
            },
            breads: {
              name: "×œ×—×× ×™×•×ª ×•×¤×¨× ×•×ª",
              emoji: "ğŸ¥–",
              items: [
                { name: "×œ×—×× ×™×” ×¢×’×•×œ×” ×§×œ×•×¢×”" },
                { name: "×œ×—×× ×™×” ××–×•× ×•×ª" },
                { name: "×œ×—× ×‘×™×ª (×¤×¨× ×”)" },
              ],
            },
            salads: {
              name: "×¡×œ×˜×™×",
              emoji: "ğŸ¥—",
              items: [
                "××˜×‘×•×—×”",
                "×—×¦×™×œ ××˜×•×’×Ÿ ×‘×•×™× ×’×¨×˜",
                "×—×¦×™×œ ×‘××™×•× ×–",
                "×—×¦×™×œ ×–'×¢×œ×•×§ - ×§×œ×•×™",
                "×—×¦×™×œ ×‘×œ××“×™-×—×¦×™×œ ×§×œ×•×™ ×‘×˜×—×™× ×”",
                "×¡×œ×§ ××¨×•×§××™",
                "×’×–×¨ ×˜×¨×™×¤×•×œ×™×˜××™",
                "×¡×œ×˜ ×™×¨×•×§ â€“ ×‘×ª×•×¡×¤×ª ×¤×™×¦×•×—×™× ×—××•×¦×™×•×ª ×•×¨×•×˜×‘ ×¡×™×œ××Ÿ",
                "×¤×œ×¤×œ ×—×¨×™×£-××ª×•×‘×œ ×‘×©×•×",
                "×—×•××•×¡ ×™×©×¨××œ×™",
                "×˜×—×™× ×”",
                "×¡×œ×˜ ×¢×¨×‘×™-×§×•×‘×™×•×ª ×¢×’×‘× ×™×•×ª ×‘×™×¨×§ ×©×•× ×•×¤×œ×¤×œ ×—×¨×™×£",
                "×¡×œ×˜ ×™×¨×§×•×ª ×™×©×¨××œ×™",
                "×—×¡×” ×¢× ×©×¨×™",
                "×›×¨×•×‘ ×œ×‘×Ÿ- ×‘×™×¨×§ ×—××•×¦×™×•×ª ×•×‘×•×˜× ×™×",
                "×—××•×¦×™ ×”×‘×™×ª",
                "×–×™×ª×™× ××‘×•×§×¢×™× ×’×“×•×œ×™×",
                "×˜×‘×¢×•×ª ××œ×¤×¤×•×Ÿ ×‘×©××™×¨",
                "×›×¨×•×‘ ×•×’×–×¨ ×‘××™×•× ×– (×§×•×œ×¡×œ×•)",
                "×›×¨×•×‘ ××“×•× ×‘××™×•× ×–",
                "×›×¨×•×‘ ××“×•× ×•×—××•×¦×™×•×ª",
                "×ª×™×¨×¡ ××§×¡×™×§× ×™",
                "×¤×•×œ×™×-××ª×•×‘×œ×™× ×‘×›××•×Ÿ",
                '×¡×œ×˜ ××™×•× ×–-×§×•×‘×™×•×ª ×ª×¤×•"×',
                "×˜××‘×•×œ×”",
              ].map((name) => ({ name })),
            },
            thirdMealFish: {
              name: "×“×’×™× ×œ×¡×¢×•×“×” ×©×œ×™×©×™×ª",
              emoji: "ğŸŸ",
              items: [
                {
                  name: "×¤×™×œ×” ××•×©×˜ ××–×¨×—×™ - ×‘×¨×•×˜×‘ ×¢×’×‘× ×™×•×ª, ×¤×œ×¤×œ ×©×•× ×•×’×¨×’×¨×™ ×—×•××•×¡.",
                },
                {
                  name: "×¤×™×œ×” ××•×©×˜ ××˜×•×’×Ÿ â€“ ××•×’×© ×œ×¦×“ ×¨×•×˜×‘ ×¦'×¨××œ×” ×¤×™×§× ×˜×™ ×•×¤×œ×—×™ ×œ×™××•×Ÿ.",
                },
              ],
            },
          },
          extraServices: {
            specialSides: {
              name: "×ª×•×¡×¤×•×ª ××™×•×—×“×•×ª",
              emoji: "âœ¨",
              items: [
                { name: "×—×•×¨×©×˜ ×¡×‘×–×™", extraCost: 8, perPerson: true },
                { name: "×’×•× ×“×™", extraCost: 10, perPerson: true },
              ],
            },
            extraPlates: {
              name: "×¤×œ×˜×•×ª ×¤×™× ×•×§",
              emoji: "ğŸ ",
              items: [
                {
                  name: "50 ×§×¦×™×¦×•×ª ×“×’×™× ×¡×œ×•××•×Ÿ ×‘×¨×•×˜×‘ ××–×¨×—×™ ×¢×‘×•×“×ª ×™×“ - ××•××œ×¥!",
                  extraCost: 250,
                },
                { name: "×¡×™×’×¨×™× ×’×¡×˜×¨×•× ×•× ×¢× ×§", extraCost: 150 },
                { name: "×¤×¡×˜×œ×™× ×’×¡×˜×¨×•× ×•× ×¢× ×§", extraCost: 150 },
                { name: "×§×•×‘×” ×‘×•×¨×’×•×œ ×’×¡×˜×¨×•× ×•× ×¢× ×§", extraCost: 150 },
                { name: "×‘×©×¨ ×¨××© ×‘×¡×’× ×•×Ÿ ××–×¨×—×™ ×’×¡×˜×¨×•× ×•× ×¢× ×§", extraCost: 450 },
                { name: "×¦×³×™×¤×¡ ×’×¡×˜×¨×•× ×•× ×¢× ×§", extraCost: 150 },
                { name: "×©× ×™×¦×œ×•× ×™× ×’×¡×˜×¨×•× ×•× ×¢× ×§", extraCost: 250 },
              ],
            },
            desserts: {
              name: "×× ×” ××—×¨×•× ×”",
              emoji: "ğŸ°",
              items: [{ name: "×¤×œ×˜×ª ××™×§×¡ ×§×™× ×•×—×™×", extraCost: 180 }],
            },
            eventServices: {
              name: "× ×™×”×•×œ ××™×¨×•×¢",
              emoji: "ğŸ¤µ",
              type: "checkbox",
              id: "full_event_management",
              label: "×× ×™ ××¢×•× ×™×™×Ÿ ×‘×”×¦×¢×ª ××—×™×¨ ×œ× ×™×”×•×œ ××™×¨×•×¢ ××œ×",
            },
          },
        };

        // --- APPLICATION STATE ---
        let currentStep = 1;
        const totalSteps = 2;
        let order = {
          packageId: null,
          quantity: 30,
          selections: {},
          extraServices: {},
          contact: {
            eventDate: null,
          },
        };

        // --- DOM ELEMENTS ---
        const steps = document.querySelectorAll(".step");
        const progressSteps = document.querySelectorAll(".progress-step");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const mobilePrevBtn = document.getElementById("mobilePrevBtn");
        const mobileNextBtn = document.getElementById("mobileNextBtn");
        const menuOptionsContainer = document.getElementById("menuOptions");
        const menuCompositionContainer =
          document.getElementById("menuComposition");
        const extraServicesCard = document.getElementById("extraServicesCard");
        const extraServicesContainer = document.getElementById(
          "extraServicesContainer"
        );
        const quantityValueEl = document.getElementById("quantityValue");
        const orderSummaryContentEls = document.querySelectorAll(
          ".order-summary-content"
        );
        const summaryTotalEls = document.querySelectorAll(".summary-total");
        const totalPriceEls = document.querySelectorAll(".total-price");
        const summaryQuantityEls =
          document.querySelectorAll(".summaryQuantity");
        const mobileTotalPriceEl = document.getElementById("mobileTotalPrice");
        const feedbackAlertEl = document.getElementById("feedbackAlert");
        const successModal = document.getElementById("successModal");
        const changeMenuBtn = document.getElementById("changeMenuBtn");
        const quantityCard = document.getElementById("quantityCard");
        const specialNoteContainer = document.getElementById(
          "specialNoteContainer"
        );

        // --- INITIALIZATION ---
        const init = () => {
          setupThemeToggle();
          renderAllPackages();
          renderDateChips();
          setupEventListeners();
          updateStepUI();
          updateSummary();
        };

        // --- EVENT LISTENERS SETUP ---
        const setupEventListeners = () => {
          [nextBtn, mobileNextBtn].forEach((btn) =>
            btn.addEventListener("click", () => changeStep(1))
          );
          [prevBtn, mobilePrevBtn].forEach((btn) =>
            btn.addEventListener("click", () => changeStep(-1))
          );
          changeMenuBtn.addEventListener("click", resetPackageSelection);
          document
            .getElementById("quantity-plus")
            .addEventListener("click", () => changeQuantity(1));
          document
            .getElementById("quantity-minus")
            .addEventListener("click", () => changeQuantity(-1));
          quantityValueEl.addEventListener("change", (e) => {
            let val = parseInt(e.target.value);
            if (isNaN(val) || val < 30) val = 30;
            order.quantity = val;
            quantityValueEl.value = val;
            updateSummary();
            toggleSpecialNote();
          });
          document
            .getElementById("eventDateCustom")
            .addEventListener("input", (e) => {
              order.contact.eventDate = e.target.value;
              validateStep();
            });
          document
            .getElementById("closeModalBtn")
            .addEventListener("click", () => {
              successModal.classList.remove("visible");
              resetForm();
            });
          document
            .getElementById("copyBtn")
            .addEventListener("click", copySummary);
          document
            .getElementById("whatsappBtn")
            .addEventListener("click", sendWhatsApp);

          // FIX: Add event listeners to contact fields
          const contactInputs = ["fullName", "phone", "address"];
          contactInputs.forEach((inputId) => {
            document
              .getElementById(inputId)
              .addEventListener("input", validateStep);
          });
        };

        // --- NEW --- Theme Toggle Logic
        const setupThemeToggle = () => {
          const themeToggleBtn = document.getElementById("themeToggleBtn");
          const htmlEl = document.documentElement;
          const prefersDarkScheme = window.matchMedia(
            "(prefers-color-scheme: dark)"
          );

          const applyTheme = (theme) => {
            htmlEl.classList.toggle("dark", theme === "dark");
          };

          const savedTheme = localStorage.getItem("theme");

          // On initial load, prioritize saved theme, otherwise use system preference
          if (savedTheme) {
            applyTheme(savedTheme);
          } else {
            applyTheme(prefersDarkScheme.matches ? "dark" : "light");
          }

          // Listen for real-time changes in system preference
          prefersDarkScheme.addEventListener("change", (e) => {
            // Only apply system preference if the user hasn't manually set a theme
            if (!localStorage.getItem("theme")) {
              applyTheme(e.matches ? "dark" : "light");
            }
          });

          // Handle manual toggle, which sets/overrides the theme in localStorage
          themeToggleBtn.addEventListener("click", () => {
            const isDark = htmlEl.classList.toggle("dark");
            localStorage.setItem("theme", isDark ? "dark" : "light");
          });
        };

        // --- RENDERING FUNCTIONS ---
        const renderAllPackages = () => {
          menuOptionsContainer.innerHTML = "";
          cateringData.packages.forEach((pkg) => {
            const card = document.createElement("div");
            card.className = "option-card";
            card.dataset.packageId = pkg.id;

            const descriptionHTML = Array.isArray(pkg.description)
              ? `<ul class="option-description-list">${pkg.description
                  .map(
                    (item) =>
                      `<li><span class="emoji">âœ…</span><span>${item}</span></li>`
                  )
                  .join("")}</ul>`
              : `<div class="option-description">${pkg.description}</div>`;

            card.innerHTML = `
              <img src="${pkg.image}" alt="${pkg.name}" class="option-card-image" onerror="this.style.display='none'">
              <div class="option-card-content">
                <div class="option-title">${pkg.name}</div>
                ${descriptionHTML}
                <div class="option-price">â‚ª${pkg.price}</div>
              </div>
            `;
            card.addEventListener("click", () => selectPackage(pkg.id));
            menuOptionsContainer.appendChild(card);
          });
        };

        const createSelectionGrid = (selectionKey, categoryKey, limit) => {
          const categoryData = cateringData.menuItems[categoryKey];
          if (!categoryData) return "";

          let selectedCount = order.selections[selectionKey]?.length || 0;

          const displayName = categoryData.name;

          return `
                <div class="selection-section card" data-selection-key="${selectionKey}" style="animation: fadeIn 0.5s;">
                    <div class="selection-title">
                        <span>${categoryData.emoji || ""} ${displayName}</span>
                        <div class="selection-controls">
                            <span class="feedback-indicator" id="feedback-${selectionKey}"></span>
                            <span class="selection-counter" id="counter-${selectionKey}">${selectedCount}/${limit}</span>
                            <button class="btn btn-secondary btn-small change-selection-btn" data-category="${selectionKey}" style="display: none;">×©×™× ×•×™</button>
                        </div>
                    </div>
                    <div class="items-grid" data-category="${selectionKey}">
                        ${categoryData.items
                          .map(
                            (item) => `
                            <div class="item-card" data-item-name="${
                              item.name
                            }">
                                <span class="item-name">${item.name}</span>
                                ${
                                  item.extraCost
                                    ? `<span class="item-price">+â‚ª${item.extraCost}</span>`
                                    : ""
                                }
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>`;
        };

        const renderMenuComposition = () => {
          menuCompositionContainer.innerHTML = "";
          const selectedPackage = getSelectedPackage();
          if (!selectedPackage || !selectedPackage.structure) return;

          selectedPackage.structure.forEach((meal) => {
            const mealSection = document.createElement("div");
            mealSection.className = "meal-section card";
            mealSection.style.animation = "fadeIn 0.5s";
            mealSection.innerHTML = `<div class="meal-title">${meal.name}</div>`;

            Object.keys(meal).forEach((categoryKey) => {
              if (["name", "type", "options", "included"].includes(categoryKey))
                return;
              const limit = meal[categoryKey];
              const selectionKey = `${meal.name}_${categoryKey}`;
              mealSection.innerHTML += createSelectionGrid(
                selectionKey,
                categoryKey,
                limit
              );
            });

            if (meal.type === "choice") {
              const choiceContainer = document.createElement("div");
              choiceContainer.className = "shabbat-morning-choice";
              const selectionKey = `${meal.name}_choice`;
              choiceContainer.dataset.selectionKey = selectionKey;

              const choiceMade = order.selections[selectionKey];

              choiceContainer.innerHTML = `
                        <div class="selection-title">
                          <span>×‘×—×¨×• ××¤×©×¨×•×ª ×œ×¡×¢×•×“×ª ×‘×•×§×¨</span>
                          <span class="feedback-indicator" id="feedback-${selectionKey}"></span>
                        </div>
                        <div class="options-grid">
                            <div class="option-card" data-choice="cholent">
                                <div class="option-card-content">
                                    <div class="option-title">${meal.options.cholent.name}</div>
                                    <div class="option-description">${meal.options.cholent.description}</div>
                                </div>
                            </div>
                            <div class="option-card" data-choice="custom">
                                <div class="option-card-content">
                                    <div class="option-title">${meal.options.custom.name}</div>
                                    <div class="option-description">${meal.options.custom.description}</div>
                                </div>
                            </div>
                        </div>
                        <div class="custom-selection-container" style="display: none;"></div>
                    `;
              mealSection.appendChild(choiceContainer);

              if (choiceMade === "custom") {
                const customContainer = choiceContainer.querySelector(
                  ".custom-selection-container"
                );
                const customOptions = meal.options.custom;
                let customHTML = "";
                Object.keys(customOptions).forEach((categoryKey) => {
                  if (["name", "description"].includes(categoryKey)) return;
                  const limit = customOptions[categoryKey];
                  const subSelectionKey = `${meal.name}_custom_${categoryKey}`;
                  customHTML += createSelectionGrid(
                    subSelectionKey,
                    categoryKey,
                    limit
                  );
                });
                customContainer.innerHTML = customHTML;
                customContainer.style.display = "flex";
              }
            }

            if (meal.included) {
              const includedList = meal.included
                .map(
                  (item) => `
                        <div class="item-card selected disabled" style="cursor: default;">
                            <span class="item-name">${item}</span>
                        </div>`
                )
                .join("");
              mealSection.innerHTML += `<div class="items-grid">${includedList}</div>`;
            }

            menuCompositionContainer.appendChild(mealSection);
          });

          updateMenuCompositionUI();

          if (!menuCompositionContainer._delegationBound) {
            menuCompositionContainer.addEventListener("click", (e) => {
              const card = e.target.closest(".item-card");
              if (card && !card.classList.contains("disabled")) {
                selectMenuItem(card);
                return;
              }

              const choiceCard = e.target.closest(
                ".shabbat-morning-choice .option-card"
              );
              if (choiceCard) {
                selectShabbatMorningChoice(choiceCard);
                return;
              }

              const btn = e.target.closest(".change-selection-btn");
              if (btn) {
                revealCategoryItems(btn.dataset.category);
                return;
              }
            });
            menuCompositionContainer._delegationBound = true;
          }
        };

        const renderDateChips = () => {
          const container = document.getElementById("dateChipsContainer");
          container.innerHTML = "";
          const today = new Date();
          const dayNames = [
            "×¨××©×•×Ÿ",
            "×©× ×™",
            "×©×œ×™×©×™",
            "×¨×‘×™×¢×™",
            "×—××™×©×™",
            "×©×™×©×™",
            "×©×‘×ª",
          ];

          for (let i = 1; i <= 7; i++) {
            const date = new Date();
            date.setDate(today.getDate() + i);

            const chip = document.createElement("div");
            chip.className = "date-chip";
            chip.dataset.date = date.toISOString().split("T")[0];

            const dayName = dayNames[date.getDay()];
            const dateStr = `${date.getDate()}/${date.getMonth() + 1}`;

            chip.innerHTML = `
        <div class="day-name">${dayName}</div>
        <div class="date-str">${dateStr}</div>
      `;
            chip.addEventListener("click", () => selectDateChip(chip));
            container.appendChild(chip);
          }

          const otherChip = document.createElement("div");
          otherChip.className = "date-chip";
          otherChip.id = "otherDateChip";
          otherChip.innerHTML = `<div class="day-name">××—×¨</div>`;
          otherChip.addEventListener("click", () =>
            selectOtherDateChip(otherChip)
          );
          container.appendChild(otherChip);
        };

        const renderExtraServices = () => {
          extraServicesCard.style.display = "block";
          extraServicesContainer.innerHTML = "";
          for (const categoryKey in cateringData.extraServices) {
            const category = cateringData.extraServices[categoryKey];
            const section = document.createElement("div");
            section.className = "selection-section";

            if (category.type === "checkbox") {
              section.innerHTML = `
                  <div class="selection-title"><span>${category.emoji || ""} ${
                category.name
              }</span></div>
                  <label class="form-group-checkbox" for="${category.id}">
                      <input type="checkbox" id="${
                        category.id
                      }" data-category="${categoryKey}">
                      <label for="${category.id}">${category.label}</label>
                  </label>
                `;
              extraServicesContainer.appendChild(section);
              document
                .getElementById(category.id)
                .addEventListener("change", (e) => {
                  const isChecked = e.target.checked;
                  if (isChecked) {
                    order.extraServices[categoryKey] = [category.label];
                  } else {
                    delete order.extraServices[categoryKey];
                  }
                  updateSummary();
                });
            } else {
              section.innerHTML = `
                  <div class="selection-title"><span>${category.emoji || ""} ${
                category.name
              }</span></div>
                  <div class="items-grid" data-category="${categoryKey}">
                  ${category.items
                    .map((item) => {
                      const isQuantityPlatter = categoryKey === "extraPlates";

                      const footerHTML = isQuantityPlatter
                        ? `
                        <div class="item-card-footer">
                            <span class="item-price">+â‚ª${item.extraCost}</span>
                            <div class="item-quantity-selector" style="display: none;">
                                <button type="button" class="item-quantity-btn minus">âˆ’</button>
                                <span class="item-quantity-value">1</span>
                                <button type="button" class="item-quantity-btn plus">+</button>
                            </div>
                        </div>
                      `
                        : item.extraCost
                        ? `<span class="item-price">+â‚ª${item.extraCost}</span>`
                        : "";

                      return `
                      <div class="item-card" data-item-name="${item.name}" data-category="${categoryKey}">
                        <span class="item-name">${item.name}</span>
                        ${footerHTML}
                      </div>
                      `;
                    })
                    .join("")}
                  </div>
                `;
              extraServicesContainer.appendChild(section);
              section.querySelectorAll(".item-card").forEach((card) => {
                card.addEventListener("click", (e) => {
                  if (e.target.classList.contains("item-quantity-btn")) return;
                  selectExtraService(card);
                });
              });
              section
                .querySelectorAll(".item-quantity-btn.plus")
                .forEach((btn) => {
                  btn.addEventListener("click", (e) => {
                    const card = e.target.closest(".item-card");
                    changeExtraServiceQuantity(
                      card.dataset.itemName,
                      card.dataset.category,
                      1
                    );
                  });
                });
              section
                .querySelectorAll(".item-quantity-btn.minus")
                .forEach((btn) => {
                  btn.addEventListener("click", (e) => {
                    const card = e.target.closest(".item-card");
                    changeExtraServiceQuantity(
                      card.dataset.itemName,
                      card.dataset.category,
                      -1
                    );
                  });
                });
            }
          }
          updateExtraServicesUI();
        };

        // --- UI UPDATE FUNCTIONS ---
        const updateStepUI = () => {
          steps.forEach((step, index) => {
            step.classList.toggle("active", index + 1 === currentStep);
          });
          progressSteps.forEach((step, index) => {
            const stepNumber = index + 1;
            step.classList.toggle("active", stepNumber === currentStep);
            step.classList.toggle("completed", stepNumber < currentStep);
          });

          prevBtn.style.display = currentStep > 1 ? "flex" : "none";
          mobilePrevBtn.style.display = currentStep > 1 ? "flex" : "none";

          nextBtn.textContent =
            currentStep === totalSteps ? "×©×œ×— ×”×–×× ×”" : "×”×‘×";
          mobileNextBtn.textContent =
            currentStep === totalSteps ? "×©×œ×— ×”×–×× ×”" : "×”×‘×";
          validateStep();
        };

        const updateMenuCompositionUI = () => {
          menuCompositionContainer
            .querySelectorAll(".selection-section")
            .forEach((section) => {
              const selectionKey = section.dataset.selectionKey;
              if (!selectionKey) return;

              const selectedItems = order.selections[selectionKey] || [];
              const limit = getLimitForSelection(selectionKey);
              const isComplete = selectedItems.length >= limit;

              const feedbackEl = section.querySelector(
                `[id="feedback-${selectionKey}"]`
              );
              const counterEl = section.querySelector(
                `[id="counter-${selectionKey}"]`
              );
              const changeBtn = section.querySelector(
                `.change-selection-btn[data-category="${selectionKey}"]`
              );
              const grid = section.querySelector(
                `.items-grid[data-category="${selectionKey}"]`
              );

              if (feedbackEl) {
                feedbackEl.style.display = isComplete ? "none" : "inline-block";
              }
              if (counterEl) {
                counterEl.textContent = `${selectedItems.length}/${limit}`;
                counterEl.classList.toggle("completed", isComplete);
              }
              if (changeBtn && counterEl) {
                changeBtn.style.display = isComplete ? "inline-block" : "none";
                counterEl.style.display = isComplete ? "none" : "inline-block";
              }
              if (grid) {
                grid.querySelectorAll(".item-card").forEach((card) => {
                  const isSelected = selectedItems.includes(
                    card.dataset.itemName
                  );
                  card.classList.toggle("selected", isSelected);
                  card.classList.toggle("disabled", isComplete && !isSelected);
                  card.style.display =
                    isComplete && !isSelected ? "none" : "flex";
                });
              }
            });

          const choiceContainer = menuCompositionContainer.querySelector(
            ".shabbat-morning-choice"
          );
          if (choiceContainer) {
            const selectionKey = choiceContainer.dataset.selectionKey;
            const choiceMade = order.selections[selectionKey];
            const feedbackEl = choiceContainer.querySelector(
              `[id="feedback-${selectionKey}"]`
            );
            if (feedbackEl) {
              feedbackEl.style.display = choiceMade ? "none" : "inline-block";
            }
            choiceContainer.querySelectorAll(".option-card").forEach((card) => {
              card.classList.toggle(
                "selected",
                card.dataset.choice === choiceMade
              );
            });
          }
        };

        const updateExtraServicesUI = () => {
          for (const categoryKey in cateringData.extraServices) {
            const category = cateringData.extraServices[categoryKey];

            if (category.type === "checkbox") {
              const checkbox = document.getElementById(category.id);
              if (checkbox) {
                checkbox.checked = !!(
                  order.extraServices[categoryKey] &&
                  order.extraServices[categoryKey].length > 0
                );
              }
            } else if (categoryKey === "extraPlates") {
              const grid = extraServicesContainer.querySelector(
                `.items-grid[data-category="${categoryKey}"]`
              );
              if (grid) {
                grid.querySelectorAll(".item-card").forEach((card) => {
                  const itemName = card.dataset.itemName;
                  const quantity =
                    order.extraServices[categoryKey]?.[itemName] || 0;

                  const selector = card.querySelector(
                    ".item-quantity-selector"
                  );
                  const valueEl = card.querySelector(".item-quantity-value");

                  card.classList.toggle("selected", quantity > 0);
                  if (selector)
                    selector.style.display = quantity > 0 ? "flex" : "none";
                  if (valueEl) valueEl.textContent = quantity;
                });
              }
            } else {
              const selectedItems = order.extraServices[categoryKey] || [];
              const grid = extraServicesContainer.querySelector(
                `.items-grid[data-category="${categoryKey}"]`
              );
              if (grid) {
                const cards = grid.querySelectorAll(".item-card");
                cards.forEach((card) => {
                  const itemName = card.dataset.itemName;
                  card.classList.toggle(
                    "selected",
                    selectedItems.includes(itemName)
                  );
                });
              }
            }
          }
        };

        const updateSummary = () => {
          summaryQuantityEls.forEach((el) => (el.textContent = order.quantity));
          quantityValueEl.value = order.quantity;

          const selectedPackage = getSelectedPackage();
          let basePrice = 0;
          let extrasPrice = 0;
          let summaryHTML =
            '<div style="text-align: center; color: #666; padding: 20px;">×‘×—×¨×• ×—×‘×™×œ×ª ×ª×¤×¨×™×˜ ×œ×”×ª×—×œ×”</div>';

          if (selectedPackage) {
            basePrice = selectedPackage.price * order.quantity;
            summaryHTML = `
        <div class="summary-section">
          <div class="summary-section-title">${selectedPackage.name}</div>
          <div class="summary-item">
            <span class="summary-item-name">××—×™×¨ ×‘×¡×™×¡ (â‚ª${
              selectedPackage.price
            } x ${order.quantity})</span>
            <span class="summary-item-price">â‚ª${basePrice.toLocaleString()}</span>
          </div>
        </div>
      `;

            const allExtras = [];

            for (const categoryKey in order.selections) {
              const selection = order.selections[categoryKey];
              if (Array.isArray(selection)) {
                selection.forEach((itemName) => {
                  const item = findItem(categoryKey, itemName);
                  if (item && item.extraCost) {
                    allExtras.push({
                      name: itemName,
                      price: item.extraCost * order.quantity,
                    });
                    extrasPrice += item.extraCost * order.quantity;
                  }
                });
              }
            }

            for (const categoryKey in order.extraServices) {
              const services = order.extraServices[categoryKey];

              if (categoryKey === "extraPlates") {
                for (const itemName in services) {
                  const item = findExtraService(categoryKey, itemName);
                  const quantity = services[itemName];

                  if (item && quantity > 0) {
                    const totalPrice = item.extraCost * quantity;
                    allExtras.push({
                      name: `${itemName} (x${quantity})`,
                      price: totalPrice,
                    });
                    extrasPrice += totalPrice;
                  }
                }
              } else {
                (services || []).forEach((itemName) => {
                  const service = findExtraService(categoryKey, itemName);
                  if (service) {
                    let price = 0;
                    if (service.extraCost) {
                      price = service.perPerson
                        ? service.extraCost * order.quantity
                        : service.extraCost;
                      extrasPrice += price;
                    }
                    allExtras.push({ name: itemName, price: price });
                  } else if (
                    cateringData.extraServices[categoryKey].type === "checkbox"
                  ) {
                    allExtras.push({ name: itemName, price: 0 });
                  }
                });
              }
            }

            if (allExtras.length > 0) {
              summaryHTML += `<div class="summary-section"><div class="summary-section-title">×ª×•×¡×¤×•×ª</div>`;
              allExtras.forEach((item) => {
                summaryHTML += `
                <div class="summary-item">
                  <span class="summary-item-name">${item.name}</span>
                  <span class="summary-item-price">${
                    item.price > 0 ? `â‚ª${item.price.toLocaleString()}` : ""
                  }</span>
                </div>`;
              });
              summaryHTML += `</div>`;
            }
          }

          orderSummaryContentEls.forEach((el) => (el.innerHTML = summaryHTML));
          const total = basePrice + extrasPrice;

          totalPriceEls.forEach(
            (el) => (el.textContent = `â‚ª${total.toLocaleString()}`)
          );
          mobileTotalPriceEl.textContent = `â‚ª${total.toLocaleString()}`;

          summaryTotalEls.forEach(
            (el) => (el.style.display = selectedPackage ? "flex" : "none")
          );
        };

        // --- LOGIC & ACTIONS ---
        const selectPackage = (packageId) => {
          order.packageId = packageId;
          order.selections = {};

          document
            .querySelectorAll("#menuOptions .option-card")
            .forEach((card) => {
              if (card.dataset.packageId !== packageId) {
                card.style.display = "none";
              } else {
                card.classList.add("selected");
              }
            });
          changeMenuBtn.style.display = "inline-block";
          quantityCard.style.display = "block";

          renderMenuComposition();
          renderExtraServices();
          updateSummary();
          validateStep();
          toggleSpecialNote();
        };

        const resetPackageSelection = () => {
          order.packageId = null;
          order.selections = {};
          order.extraServices = {};

          document
            .querySelectorAll("#menuOptions .option-card")
            .forEach((card) => {
              card.style.display = "flex";
              card.classList.remove("selected");
            });
          changeMenuBtn.style.display = "none";
          quantityCard.style.display = "none";

          menuCompositionContainer.innerHTML = "";
          extraServicesCard.style.display = "none";
          extraServicesContainer.innerHTML = "";
          updateSummary();
          validateStep();
          toggleSpecialNote();
        };

        const selectMenuItem = (card) => {
          const grid = card.closest(".items-grid");
          if (!grid) return;
          const selectionKey = grid.dataset.category;
          const itemName = card.dataset.itemName;
          const limit = getLimitForSelection(selectionKey);

          if (!order.selections[selectionKey]) {
            order.selections[selectionKey] = [];
          }

          const selectedInCategory = order.selections[selectionKey];

          if (selectedInCategory.includes(itemName)) {
            order.selections[selectionKey] = selectedInCategory.filter(
              (name) => name !== itemName
            );
          } else {
            if (selectedInCategory.length < limit) {
              order.selections[selectionKey].push(itemName);
            }
          }

          updateMenuCompositionUI();
          updateSummary();
          validateStep();
        };

        const selectShabbatMorningChoice = (choiceCard) => {
          const container = choiceCard.closest(".shabbat-morning-choice");
          const selectionKey = container.dataset.selectionKey;
          const choice = choiceCard.dataset.choice;

          // Set the choice
          order.selections[selectionKey] = choice;

          // Clear previous sub-selections if any
          delete order.selections["×©×‘×ª ×‘×‘×•×§×¨_custom_sides"];
          delete order.selections["×©×‘×ª ×‘×‘×•×§×¨_custom_mainCoursesShabbat"];

          // Re-render just the choice's content
          const customContainer = container.querySelector(
            ".custom-selection-container"
          );
          if (choice === "custom") {
            const meal = getSelectedPackage().structure.find(
              (m) => m.name === "×©×‘×ª ×‘×‘×•×§×¨"
            );
            const customOptions = meal.options.custom;
            let customHTML = "";
            Object.keys(customOptions).forEach((categoryKey) => {
              if (["name", "description"].includes(categoryKey)) return;
              const limit = customOptions[categoryKey];
              const subSelectionKey = `×©×‘×ª ×‘×‘×•×§×¨_custom_${categoryKey}`;
              customHTML += createSelectionGrid(
                subSelectionKey,
                categoryKey,
                limit
              );
            });
            customContainer.innerHTML = customHTML;
            customContainer.style.display = "flex";
          } else {
            customContainer.innerHTML = "";
            customContainer.style.display = "none";
          }

          updateMenuCompositionUI();
          updateSummary();
          validateStep();
        };

        const revealCategoryItems = (categoryKey) => {
          const grid = menuCompositionContainer.querySelector(
            `.items-grid[data-category="${categoryKey}"]`
          );
          const changeBtn = menuCompositionContainer.querySelector(
            `.change-selection-btn[data-category="${categoryKey}"]`
          );
          const counterEl = menuCompositionContainer.querySelector(
            `[id="counter-${categoryKey}"]`
          );

          if (grid) {
            grid.querySelectorAll(".item-card").forEach((card) => {
              card.style.display = "flex";
            });
          }
          if (changeBtn) changeBtn.style.display = "none";
          if (counterEl) counterEl.style.display = "inline-block";
        };

        const selectExtraService = (card) => {
          const categoryKey = card.dataset.category;
          const itemName = card.dataset.itemName;

          if (categoryKey === "extraPlates") {
            if (!order.extraServices[categoryKey]) {
              order.extraServices[categoryKey] = {};
            }
            const currentQuantity =
              order.extraServices[categoryKey][itemName] || 0;
            if (currentQuantity === 0) {
              order.extraServices[categoryKey][itemName] = 1;
            }
          } else {
            if (!order.extraServices[categoryKey]) {
              order.extraServices[categoryKey] = [];
            }
            const selectedInCategory = order.extraServices[categoryKey];
            if (selectedInCategory.includes(itemName)) {
              order.extraServices[categoryKey] = selectedInCategory.filter(
                (name) => name !== itemName
              );
            } else {
              order.extraServices[categoryKey].push(itemName);
            }
          }

          updateExtraServicesUI();
          updateSummary();
        };

        const changeExtraServiceQuantity = (itemName, categoryKey, amount) => {
          if (!order.extraServices[categoryKey]) {
            order.extraServices[categoryKey] = {};
          }
          let currentQuantity = order.extraServices[categoryKey][itemName] || 0;
          currentQuantity += amount;

          if (currentQuantity <= 0) {
            delete order.extraServices[categoryKey][itemName];
          } else {
            order.extraServices[categoryKey][itemName] = currentQuantity;
          }

          updateExtraServicesUI();
          updateSummary();
        };

        const selectDateChip = (chip) => {
          document
            .querySelectorAll(".date-chip")
            .forEach((c) => c.classList.remove("selected"));
          chip.classList.add("selected");
          document.getElementById("customDateContainer").style.display = "none";
          order.contact.eventDate = chip.dataset.date;
          validateStep();
        };

        const selectOtherDateChip = (chip) => {
          document
            .querySelectorAll(".date-chip")
            .forEach((c) => c.classList.remove("selected"));
          chip.classList.add("selected");
          const customContainer = document.getElementById(
            "customDateContainer"
          );
          customContainer.style.display = "block";
          const customInput = document.getElementById("eventDateCustom");

          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          customInput.min = tomorrow.toISOString().split("T")[0];

          order.contact.eventDate = customInput.value;
          validateStep();
        };

        const changeQuantity = (amount) => {
          const newQuantity = order.quantity + amount;
          if (newQuantity >= 30) {
            order.quantity = newQuantity;
            quantityValueEl.value = order.quantity;
            updateSummary();
            toggleSpecialNote();
          }
        };

        const changeStep = (direction) => {
          if (direction === 1 && !validateStep()) {
            showValidationError();
            return;
          }

          if (direction === 1 && currentStep === totalSteps) {
            submitOrder();
            return;
          }

          currentStep += direction;

          updateStepUI();
          window.scrollTo(0, 0);
        };

        const getValidationMessage = () => {
          switch (currentStep) {
            case 1:
              if (!order.packageId) return "×™×© ×œ×‘×—×•×¨ ×—×‘×™×œ×ª ×ª×¤×¨×™×˜.";
              // Add validation for shabbat package
              if (order.packageId === "shabbat_full") {
                const shabbatMorningChoice =
                  order.selections["×©×‘×ª ×‘×‘×•×§×¨_choice"];
                if (!shabbatMorningChoice)
                  return "×™×© ×œ×‘×—×•×¨ ××¤×©×¨×•×ª ×œ×¡×¢×•×“×ª ×©×‘×ª ×‘×‘×•×§×¨.";
                if (shabbatMorningChoice === "custom") {
                  if (
                    (order.selections["×©×‘×ª ×‘×‘×•×§×¨_custom_sides"]?.length || 0) <
                    3
                  )
                    return "×™×© ×œ×‘×—×•×¨ 3 ×ª×•×¡×¤×•×ª ×œ×©×‘×ª ×‘×‘×•×§×¨.";
                  if (
                    (order.selections["×©×‘×ª ×‘×‘×•×§×¨_custom_mainCoursesShabbat"]
                      ?.length || 0) < 3
                  )
                    return "×™×© ×œ×‘×—×•×¨ 3 ×× ×•×ª ×¢×™×§×¨×™×•×ª ×œ×©×‘×ª ×‘×‘×•×§×¨.";
                }
                if (
                  (order.selections["×¡×¢×•×“×” ×©×œ×™×©×™×ª_thirdMealFish"]?.length ||
                    0) < 1
                )
                  return "×™×© ×œ×‘×—×•×¨ ×“×’ ×œ×¡×¢×•×“×” ×©×œ×™×©×™×ª.";
              }
              return "";
            case 2:
              if (!document.getElementById("fullName").value)
                return "×™×© ×œ××œ× ×©× ××œ×.";
              if (!document.getElementById("phone").value)
                return "×™×© ×œ××œ× ××¡×¤×¨ ×˜×œ×¤×•×Ÿ.";
              if (!document.getElementById("address").value)
                return "×™×© ×œ××œ× ×›×ª×•×‘×ª.";
              if (!order.contact.eventDate) return "×™×© ×œ×‘×—×•×¨ ×ª××¨×™×š ×œ××™×¨×•×¢.";
              return "";
            default:
              return "××™×¨×¢×” ×©×’×™××”. ×× × ×‘×“×•×§ ××ª ×”×¤×¨×˜×™×.";
          }
        };

        const validateStep = () => {
          let isValid = false;
          feedbackAlertEl.style.display = "none";

          switch (currentStep) {
            case 1:
              isValid = !!order.packageId;
              if (isValid && order.packageId === "shabbat_full") {
                const shabbatMorningChoice =
                  order.selections["×©×‘×ª ×‘×‘×•×§×¨_choice"];
                if (!shabbatMorningChoice) {
                  isValid = false;
                } else if (shabbatMorningChoice === "custom") {
                  const sidesValid =
                    (order.selections["×©×‘×ª ×‘×‘×•×§×¨_custom_sides"]?.length ||
                      0) === 3;
                  const mainsValid =
                    (order.selections["×©×‘×ª ×‘×‘×•×§×¨_custom_mainCoursesShabbat"]
                      ?.length || 0) === 3;
                  if (!sidesValid || !mainsValid) isValid = false;
                }
                const fishValid =
                  (order.selections["×¡×¢×•×“×” ×©×œ×™×©×™×ª_thirdMealFish"]?.length ||
                    0) === 1;
                if (!fishValid) isValid = false;
              }
              break;
            case 2:
              const name = document.getElementById("fullName").value;
              const phone = document.getElementById("phone").value;
              const address = document.getElementById("address").value;
              isValid = name && phone && address && order.contact.eventDate;
              break;
          }
          nextBtn.disabled = !isValid;
          mobileNextBtn.disabled = !isValid;
          return isValid;
        };

        const showValidationError = () => {
          const message = getValidationMessage();
          if (message) {
            feedbackAlertEl.textContent = `âš ï¸ ${message}`;
            feedbackAlertEl.style.display = "block";
          }
        };

        const submitOrder = async () => {
          if (!validateStep()) {
            showValidationError();
            return;
          }

          nextBtn.disabled = true;
          nextBtn.textContent = "×©×•×œ×—...";
          mobileNextBtn.disabled = true;
          mobileNextBtn.textContent = "×©×•×œ×—...";

          order.contact.fullName = document.getElementById("fullName").value;
          order.contact.phone = document.getElementById("phone").value;
          order.contact.address = document.getElementById("address").value;
          order.contact.notes = document.getElementById("notes").value;

          // Prepare data for WordPress AJAX

          const formData = new URLSearchParams();
          formData.append("action", "send_catering_order");
          // Ensure selections is always an object of arrays
          if (!order.selections || typeof order.selections !== "object") {
            order.selections = {};
          } else {
            for (const key in order.selections) {
              if (!Array.isArray(order.selections[key])) {
                order.selections[key] = order.selections[key]
                  ? [order.selections[key]]
                  : [];
              }
            }
          }

          // Ensure extraServices is properly structured
          if (!order.extraServices || typeof order.extraServices !== "object") {
            order.extraServices = {};
          } else {
            for (const key in order.extraServices) {
              // extraPlates should remain as an object with quantities
              if (key === "extraPlates") {
                if (
                  typeof order.extraServices[key] !== "object" ||
                  Array.isArray(order.extraServices[key])
                ) {
                  order.extraServices[key] = {};
                }
              } else {
                // Other categories should be arrays
                if (!Array.isArray(order.extraServices[key])) {
                  order.extraServices[key] = order.extraServices[key]
                    ? [order.extraServices[key]]
                    : [];
                }
              }
            }
          }

          // Add package name to order data
          const selectedPackage = getSelectedPackage();
          order.packageName = selectedPackage ? selectedPackage.name : null;

          order.summary = generateWhatsAppSummary();
          formData.append("order_data", JSON.stringify(order));

          const nonce =
            typeof catering_ajax_obj !== "undefined"
              ? catering_ajax_obj.nonce
              : "";
          formData.append("security", nonce);

          const ajaxUrl =
            typeof catering_ajax_obj !== "undefined"
              ? catering_ajax_obj.ajax_url
              : "/wp-admin/admin-ajax.php";

          try {
            console.groupCollapsed("ğŸ›°ï¸ Sending order to admin-ajax.php");
            console.log("URL:", ajaxUrl);
            console.log("formData order:", order);
            console.log("order.extraServices:", order.extraServices);
            console.log(
              "order.extraServices.extraPlates:",
              order.extraServices.extraPlates
            );
            console.groupEnd();

            let response;
            if (
              window.location.hostname === "localhost" ||
              window.location.hostname === "127.0.0.1"
            ) {
              // Simulate a successful response for localhost
              response = {
                json: async () => ({ success: true }),
              };
            } else {
              response = await fetch(ajaxUrl, {
                method: "POST",
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                body: formData.toString(),
              });
            }

            const result = await response.json();

            if (result.success) {
              showSuccessModal();
            } else {
              throw new Error(result.data || "×©×œ×™×—×” × ×›×©×œ×”, × ×¡×” ×©×•×‘");
            }
          } catch (error) {
            console.error("Error:", error);
            feedbackAlertEl.textContent = `âš ï¸ ${error.message}`;
            feedbackAlertEl.style.display = "block";
          } finally {
            nextBtn.disabled = false;
            nextBtn.textContent = "×©×œ×— ×”×–×× ×”";
            mobileNextBtn.disabled = false;
            mobileNextBtn.textContent = "×©×œ×— ×”×–×× ×”";
          }
        };

        const showSuccessModal = () => {
          const summaryText = generateWhatsAppSummary();
          document.getElementById("whatsappSummary").value = summaryText;
          successModal.classList.add("visible");
        };

        const generateWhatsAppSummary = () => {
          const selectedPackage = getSelectedPackage();
          let summary = `*×”×™×™, ×©×œ×—×ª×™ ×”×–×× ×” ×—×“×©×” ×“×¨×š ×”××ª×¨* ğŸ‰\n\n`;
          summary += `*×¡×™×›×•× ×”×”×–×× ×”:*\n`;
          summary += `-------------------\n`;
          summary += `*×—×‘×™×œ×”:* ${selectedPackage.name}\n`;
          summary += `*×›××•×ª ×× ×•×ª:* ${order.quantity}\n\n`;

          summary += `*×‘×—×™×¨×•×ª:*\n`;
          if (selectedPackage && Array.isArray(selectedPackage.structure)) {
            selectedPackage.structure.forEach((menu) => {
              let mealSummaryLines = [];

              if (menu.included && menu.included.length) {
                mealSummaryLines.push(`â€¢ ××•×’×©: ${menu.included.join(", ")}`);
              }

              Object.keys(menu).forEach((categoryKey) => {
                if (
                  [
                    "name",
                    "included",
                    "type",
                    "options",
                    "thirdMealFish",
                  ].includes(categoryKey)
                )
                  return;

                const selectionKey = `${menu.name}_${categoryKey}`;
                const selected = order.selections[selectionKey] || [];

                if (selected.length > 0) {
                  const catData = cateringData.menuItems[categoryKey];
                  const catName = catData ? catData.name : categoryKey;
                  mealSummaryLines.push(`â€¢ ${catName}: ${selected.join(", ")}`);
                }
              });

              if (menu.type === "choice") {
                const choiceKey = `${menu.name}_choice`;
                const choice = order.selections[choiceKey];
                if (
                  choice &&
                  menu.options[choice] &&
                  menu.options[choice].name
                ) {
                  mealSummaryLines.push(
                    `â€¢ ×‘×—×™×¨×”: ${menu.options[choice].name}`
                  );
                  if (choice === "custom") {
                    const customSidesKey = `${menu.name}_custom_sides`;
                    const customMainsKey = `${menu.name}_custom_mainCoursesShabbat`;
                    const sides = order.selections[customSidesKey] || [];
                    const mains = order.selections[customMainsKey] || [];
                    if (sides.length > 0)
                      mealSummaryLines.push(`  - ×ª×•×¡×¤×•×ª: ${sides.join(", ")}`);
                    if (mains.length > 0)
                      mealSummaryLines.push(`  - ×¢×™×§×¨×™×•×ª: ${mains.join(", ")}`);
                  }
                }
              }

              if (menu.thirdMealFish) {
                const selectionKey = `${menu.name}_thirdMealFish`;
                const selected = order.selections[selectionKey] || [];
                if (selected.length > 0) {
                  mealSummaryLines.push(`â€¢ ×“×’×™×: ${selected.join(", ")}`);
                }
              }

              if (mealSummaryLines.length > 0) {
                summary += `- *${menu.name}:*\n${mealSummaryLines.join(
                  "\n"
                )}\n`;
              }
            });
          }

          // Extra services summary
          let extraSummary = [];

          for (const categoryKey in order.extraServices) {
            const services = order.extraServices[categoryKey];

            if (categoryKey === "extraPlates" && services) {
              for (const itemName in services) {
                const quantity = services[itemName];
                if (quantity > 0) {
                  extraSummary.push(`${itemName} (x${quantity})`);
                }
              }
            } else if (Array.isArray(services)) {
              services.forEach((serviceName) => {
                extraSummary.push(serviceName);
              });
            }
          }
          if (extraSummary.length > 0) {
            summary += `\n*×ª×•×¡×¤×•×ª ×•×©×™×¨×•×ª×™×:*\n`;
            extraSummary.forEach((serviceName) => {
              summary += `- ${serviceName}\n`;
            });
          }

          summary += `\n*×¡×”"×› ×œ×ª×©×œ×•×:* ${totalPriceEls[0].textContent}\n\n`;

          summary += `*×¤×¨×˜×™ ×§×©×¨:*\n`;
          summary += `*×©×:* ${order.contact.fullName}\n`;
          summary += `*×˜×œ×¤×•×Ÿ:* ${order.contact.phone}\n`;
          summary += `*×›×ª×•×‘×ª:* ${order.contact.address}\n`;
          if (order.contact.eventDate) {
            summary += `*×ª××¨×™×š ××™×¨×•×¢:* ${new Date(
              order.contact.eventDate
            ).toLocaleDateString("he-IL")}\n`;
          }
          if (order.contact.notes) {
            summary += `*×”×¢×¨×•×ª:* ${order.contact.notes}\n`;
          }
          summary += `-------------------\n`;
          summary += `×ª×•×“×”!`;

          return summary;
        };

        const copySummary = () => {
          const textarea = document.getElementById("whatsappSummary");
          textarea.select();
          document.execCommand("copy");
          const copyBtn = document.getElementById("copyBtn");
          copyBtn.textContent = "×”×•×¢×ª×§!";
          setTimeout(() => {
            copyBtn.textContent = "×”×¢×ª×§ ×¡×™×›×•×";
          }, 2000);
        };

        const sendWhatsApp = () => {
          const summary = document.getElementById("whatsappSummary").value;
          const phoneNumber = "972552239120"; // Replace with your number
          const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(
            summary
          )}`;
          window.open(url, "_blank");
        };

        const resetForm = () => {
          order = {
            packageId: null,
            quantity: 30,
            selections: {},
            extraServices: {},
            contact: { eventDate: null },
          };
          currentStep = 1;

          resetPackageSelection();

          document
            .querySelectorAll(".item-card.selected, .date-chip.selected")
            .forEach((el) => el.classList.remove("selected"));
          document.getElementById("customDateContainer").style.display = "none";
          document.getElementById("fullName").value = "";
          document.getElementById("phone").value = "";
          document.getElementById("address").value = "";
          document.getElementById("notes").value = "";
          quantityValueEl.value = 30;

          updateStepUI();
          updateSummary();
        };

        // --- HELPER FUNCTIONS ---
        const getSelectedPackage = () => {
          if (!order.packageId) return null;
          return cateringData.packages.find((p) => p.id === order.packageId);
        };

        const getLimitForSelection = (selectionKey) => {
          const selectedPackage = getSelectedPackage();
          if (!selectedPackage) return 0;

          for (const meal of selectedPackage.structure) {
            // Standard meal
            let key = selectionKey.replace(`${meal.name}_`, "");
            if (meal[key]) return meal[key];

            // Shabbat morning custom meal
            if (
              meal.type === "choice" &&
              selectionKey.includes(`${meal.name}_custom`)
            ) {
              key = selectionKey.replace(`${meal.name}_custom_`, "");
              if (meal.options.custom[key]) return meal.options.custom[key];
            }
          }
          return 0;
        };

        const findItem = (selectionKey, itemName) => {
          let categoryKey;
          if (selectionKey.includes("_custom_")) {
            categoryKey = selectionKey.substring(
              selectionKey.lastIndexOf("_") + 1
            );
          } else {
            categoryKey = selectionKey.substring(selectionKey.indexOf("_") + 1);
          }
          return cateringData.menuItems[categoryKey]?.items.find(
            (i) => i.name === itemName
          );
        };

        const findExtraService = (categoryKey, itemName) => {
          const category = cateringData.extraServices[categoryKey];
          if (category.type === "checkbox") {
            return category.label === itemName
              ? { name: category.label }
              : null;
          }
          return category?.items.find((i) => i.name === itemName);
        };

        const toggleSpecialNote = () => {
          const showNote =
            order.packageId === "shabbat_full" && order.quantity >= 50;
          specialNoteContainer.style.display = showNote ? "block" : "none";
        };

        // --- START THE APP ---
        init();
      });
    </script>
  </body>
</html>
